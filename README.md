## 📢 프로젝트 소개

동물들과 함께 카페, 음식점을 이용하기 위해 가게마다 일일히 전화해서
확인해보신적 있으신가요?! 더이상 여러곳을 돌아다니지 않아도 됩니다. 
반려동물과 함께 방문할 수 있는 식당과 카페를 소개하는 웹 사이트입니다 🐾

<br>

## 📅 프로젝트 기간

- **2025.02.27 ~ 2025.03.05**

<br>

## 💏 멤버 소개

<table>
  <tbody>
    <tr>
      <td width="300px" align="center">
        <a href="https://github.com/woohyuckk">
        <img src="https://avatars.githubusercontent.com/u/192562150?v=4" width="80" alt="woohyuckk"/>
        <br />
        <sub><b>woohyuckk</b></sub>
        </a>
        <br />
      </td>
         <td width="300px" align="center">
        <a href="https://github.com/sohxxny">
        <img src="https://avatars.githubusercontent.com/u/119118662?v=4" width="80" alt="sohxxny"/>
        <br />
        <sub><b>Soheun</b></sub>
        </a>
        <br />
      </td>
      <td width="300px" align="center">
        <a href="https://github.com/K-jisu">
        <img src="https://avatars.githubusercontent.com/u/90014581?v=4" width="80" alt="Jisu Kang"/>
        <br />
        <sub><b>Jisu Kang</b></sub>
        </a>
        <br />
      </td>
    </tr>
    <tr>
      <td align="center">
        <b>역할 1</b> <br/>
        <b>역할 2</b> <br/>
      </td>
      <td align="center">
        <b>역할 1</b> <br/>
        <b>역할 2</b> <br/>
      </td>
      <td align="center">
        <b>역할 1</b> <br/>
        <b>역할 2</b> <br/>
      </td>
    </tr>
    <tr>
      <td align="center">
        <a href="https://github.com/ye21iin">
        <img src="https://avatars.githubusercontent.com/u/97957438?v=4" width="80" alt="Yelin Kim"/>
        <br />
        <sub><b>ye21iin</b></sub>
        </a>
        <br />
      </td>
      <td align="center">
        <a href="https://github.com/joyounghyun550">
        <img src="https://avatars.githubusercontent.com/u/192574613?v=4" width="80" alt="JoYoungHyun"/>
        <br />
        <sub><b>JoYoungHyun</b></sub>
        </a>
        <br />
      </td>
    </tr>
    <tr>
      <td align="center">
        <b>역할 1</b> <br/>
        <b>역할 2</b> <br/>
      </td>
      <td align="center">
        <b>역할 1</b> <br/>
        <b>역할 2</b> <br/>
      </td>
      <td align="center">
    </tr>
  </tbody>
</table>

## 🛠 **기술스택**

<br>

### 📌 **프로그래밍 언어 및 프레임워크**

![JavaScript](https://img.shields.io/badge/JavaScript-F7DF1E?style=flat-square&logo=javascript&logoColor=black)
![React](https://img.shields.io/badge/React-61DAFB?style=flat-square&logo=React&logoColor=black)

### 🎨 **UI 프레임워크 및 스타일링**

![Tailwind CSS](https://img.shields.io/badge/TailwindCSS-06B6D4?style=flat-square&logo=tailwindcss&logoColor=white)
![React Icons](https://img.shields.io/badge/ReactIcons-000000?style=flat-square&logo=react&logoColor=white)
![React Toastify](https://img.shields.io/badge/ReactToastify-FF8700?style=flat-square&logo=react&logoColor=white)
![Spinner](https://img.shields.io/badge/Spinner-00A99D?style=flat-square&logo=progress&logoColor=white)

### ✅ **프로젝트 빌드 / 코드 품질 및 포맷팅**

![Vite](https://img.shields.io/badge/Vite-646CFF?style=flat-square&logo=vite&logoColor=white)
![React Router](https://img.shields.io/badge/ReactRouter-CA4245?style=flat-square&logo=react-router&logoColor=white)
![ESLint](https://img.shields.io/badge/ESLint-4B32C3?style=flat-square&logo=eslint&logoColor=white)
![Prettier](https://img.shields.io/badge/Prettier-F7B93E?style=flat-square&logo=prettier&logoColor=white)

### 🪜 **전역 상태 관리**

![Zustand](https://img.shields.io/badge/zustand-orange?style=flat-square&logo=zustand&logoColor=white)

### 🗄️ **백엔드 및 API 통신**

![TanStack Query](https://img.shields.io/badge/TanstackQuery-FF4154?style=flat-square&logo=TanstackQuery&logoColor=white)
![Kakao Map API](https://img.shields.io/badge/KakaoMapAPI-FFCD00?style=flat-square&logo=kakao&logoColor=black)
![Supabase](https://img.shields.io/badge/Supabase-3ECF8E?style=flat-square&logo=supabase&logoColor=white)

- **BaaS** (PostgreSQL 기반 Backend as a Service)

  - **Database:** 게시글, 댓글, 좋아요, 사용자 정보 저장 및 관리
  - **Authentication:** 사용자 로그인 및 회원가입 관리
  - **Storage:** 프로필 이미지 등 파일 업로드 관리

### 🗃️ **버전 관리**

![Git](https://img.shields.io/badge/Git-F05032?style=flat-square&logo=git&logoColor=white)
![GitHub](https://img.shields.io/badge/GitHub-181717?style=flat-square&logo=github&logoColor=white)

### 🚀 **배포**

[같이가개 🐾 이용하러가기](https://nbc-outsourcing-project.vercel.app/)

<br>

## 📝 **주요 기능**

### 🔐 로그인 및 회원가입 기능

- 사용자는 이메일로 회원가입 및 로그인할 수 있습니다.
- 구글 소셜 로그인을 통한 간편 로그인 기능을 제공합니다.

### 🐾 반려동물과 함께할 수 있는 장소 리스트

- 홈 화면에서 전체 피드를 볼 수 있습니다.
- '전체보기', '식당', '카페' 카테고리를 분류해서 볼 수 있는 사이드바를 제공합니다.
- 타이틀을 검색할 수 있습니다.

### 🔍 장소의 디테일 제공

- 디테일 페이지에서는 각 장소의 상세 정보 및 위치 정보를 제공합니다.
- 인증된 사용자는 댓글을 입력할 수 있습니다.

### ❤️ 좋아요 기능

- 사용자는 게시물에 좋아요 버튼을 눌러 저장할 수 있습니다.

### 👤 마이페이지

- 프로필 사진과 닉네임을 수정할 수 있습니다.
- 사용자가 '좋아요'를 한 게시물을 모아 볼 수 있습니다.

<br>

## 📁 프로젝트 구조

```
📦nbc-outsourcing-project
 ┣ 📂public
 ┣ 📂src
 ┃ ┣ 📂components
 ┃ ┃ ┣ 📂auth
 ┃ ┃ ┣ 📂buttons
 ┃ ┃ ┣ 📂common
 ┃ ┃ ┣ 📂detail
 ┃ ┃ ┃ ┣ 📂comment
 ┃ ┃ ┃ ┣ 📂place
 ┃ ┃ ┣ 📂home
 ┃ ┃ ┣ 📂layout
 ┃ ┃ ┗ 📂mypage
 ┃ ┃ ┃ ┣ 📂likes
 ┃ ┃ ┃ ┣ 📂profile
 ┃ ┣ 📂constants
 ┃ ┣ 📂libs
 ┃ ┃ ┣ 📂api
 ┃ ┃ ┣ 📂hooks
 ┃ ┃ ┗ 📂utils
 ┃ ┣ 📂pages
 ┃ ┣ 📂routes
 ┃ ┣ 📂stores
 ┃ ┣ 📜App.jsx
 ┃ ┣ 📜index.css
 ┃ ┗ 📜main.jsx
```

각 스타일 컴포넌트는 page 명칭에 맞는 pageStyle 폴더로 관리
예) page 폴더에 page.jsx / pageStyle 폴더로 페이지에 사용된 스타일 컴포넌트를 한 곳에서 확인할 수 있도록 설계

## 와이어 프레임

![image](https://github.com/user-attachments/assets/78fb31d5-9312-4d57-a159-e6db9d7ea0e8)


## ERD

![ERD](https://github.com/user-attachments/assets/72a33042-c42e-49da-89f3-bda37084bf03)

## 🛠️ 트러블 슈팅

### 🔹 데이터 리스트에서 좋아요한 카드의 좋아요 버튼 다르게 보이도록 하기

#### 🚨 문제 상황

- Supabase DB에는 전체 장소 목록과 좋아요 목록이 별도 테이블로 저장되어 있기 때문에 초기에는 두 데이터를 각각 불러온 후, 장소 목록에 좋아요 정보를 추가하는 방식으로 구현
- 무한 스크롤(infinite scroll)을 구현하면서 데이터를 점진적으로 로드해야 했는데, 이때 두 데이터를 별도로 불러오는 방식에서 문제가 발생

#### 💡 해결 방법

- SQL 에디터를 활용하여 커스텀 함수를 생성. 이 함수는 전체 장소 목록을 불러오면서 사용자 ID를 기준으로 좋아요 목록과 대조하여 해당 장소가 사용자의 좋아요 목록에 있으면 'is_liked' 속성값을 true로, 없으면 false로 설정하여 데이터를 한 번에 가져옴

```sql
CREATE OR REPLACE FUNCTION get_places_with_likes(user_id UUID)
RETURNS TABLE (
  id BIGINT,
  title TEXT,
  created_at TIMESTAMPTZ,
  description TEXT,
  charge TEXT,
  category1 TEXT,
  category2 TEXT,
  tel TEXT,
  url TEXT,
  address TEXT,
  coordinates JSON,
  image TEXT,
  is_liked BOOLEAN
)
LANGUAGE plpgsql
AS $$
BEGIN
  RETURN QUERY
  SELECT
    p.*,
    EXISTS (
      SELECT 1
      FROM likes l
      WHERE l.place_id = p.id AND l.user_id = get_places_with_likes.user_id
    ) AS is_liked
  FROM places p;
END;
$$;
```

#### ✅ 결과

- 무한 스크롤 구현 시 발생할 수 있는 데이터 불일치 문제(장소 목록과 좋아요 목록의 로드 범위가 서로 다른 현상)를 해결
- 장소 목록과 좋아요 정보를 별도로 쿼리하여 저장할 필요 없이, 단일 쿼리로 통합된 데이터를 한 번에 가져올 수 있게 됨

<hr>

### 🔹 useInView 사용시 ref, inView 작동하지 않는 문제

#### 🚨 문제 상황

- 무한스크롤 작업 중 useInView의 ref와 inView가 설정된 div에서 작동하지 않는 문제 발생

#### 🔍 원인

- 한번에 들어오는 데이터의 양이 많음. 그래서 ref가 동작을 안 했을 수 있음.

```javascript
const fetchPlacesData = async () => {
  let { data, error } = await supabase.from('place').select('*');

  if (error) {
    console.log(error);
  }

  return data;
};
```

#### 💡 해결 방법

들어오는 데이터의 양을 줄이고 테스트를 하면 잘 작동 됨.

```javascript
const fetchPlacesData = async () => {
  let { data, error } = await supabase.from('place').select('*').limit(8);

  if (error) {
    console.log(error);
  }

  return data;
};
```

#### ✅ 결과

- 데이터의 양을 줄이니 ref가 작동되면서 inView도 작동이 됨.
- 그 후로 무한스크롤 구현 시작할 수 있었음.

<hr>

### 🔹 No QueryClient set 에러 - QueryClientProvider 적용

#### 🚨 문제 상황

- useQuery를 사용하여 사용자 정보를 가져오는 과정에서 `No QueryClient set, use QueryClientProvider to set one` 에러 발생

- useQuery를 통해 탠스택쿼리로 BaaS 서버에서 데이터를 가져오는 로직 작성.
- onAuthStateChange를 통한 인증 상태를 전역 상태에 반영하는 커스텀 훅 생성.

```
const useAuthListener = () => {
  const setUserInfo = useAuthStore().setUserInfo;
  const { data: userData } = useGetUserInfo();

  useEffect(() => {
    // 인증 상태 변경 감지 및 자동 업데이트
    const {
      data: { subscription },
    } = supabase.auth.onAuthStateChange(async (_, session) => {
      const userInfo = {
        id: session?.user.id,
        email: session?.user.email,
        nickname: userData?.nickname || '',
        profile_img_url: userData?.profile_img_url || '',
      };

      setUserInfo(userInfo);
    });
    return () => {
      subscription.unsubscribe(); // Cleanup when unmounting
    };
  }, []);
};
```

#### 🔍 원인

- useAuthListener에서 useQuery를 사용하는 useGetUserInfo를 호출했으나, QueryClientProvider가 감싸고 있지 않아 QueryClient가 설정되지 않음.


#### 💡 해결 방법
```
const App = () => {
  const queryClient = new QueryClient();
  useAuthListener(); // 기존 실행 위치

  return (
    <>
      <QueryClientProvider client={queryClient}>
        <AuthListener />; // 컴포넌트화 이후 실행 위치
        <Router />
      </QueryClientProvider
    </>
  )
}
```

- QueryClientProvider를 App.jsx에서 최상위에 배치.
- useAuthListener를 QueryClientProvider 내부에서 실행되도록 별도 AuthListener 컴포넌트로 분리.
- useEffect를 두 번 사용하여 onAuthStateChange로 초기 데이터 설정 후, userData 변경 시 상태 업데이트.

#### ✅ 결과

- QueryClientProvider 내부에서 useQuery를 정상적으로 사용할 수 있게 되어 인증 상태 변경 감지 및 사용자 정보 업데이트가 원활하게 동작함.
- 단, 초기 렌더링 시 리렌더링이 여러 번 발생하는 사이드이펙트 존재.
- 개선 : useMutation으로 client-BaaS 간 비동기 통신을 대체 및 zustand 전역상태까지 관리할 수 있도록 수정.
- 최종 : userData가 fetch된 이후 상태를 업데이트하기 위해 useEffect를 두 번 사용하던 로직을 개선. 기존 AuthListener는 supabase의 세션 변경만을 감지하도록 수정.
